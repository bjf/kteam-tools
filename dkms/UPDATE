#!/bin/bash

here=`dirname $0`
case "$here" in
/*) ;;
*)  here="`pwd`/$here" ;;
esac

out="$HOME/public_html/info/dkms"
mkdir -p "$out"

# Generate each series summary.
while read -r file line
do
	# Make sure we don't stray out of the approved space.
	case "$file" in
	*/*)	continue ;;
	esac

	echo "$file $line" | "$here/dkms-jenkins-matrix" >"$file.new"
	mv -f "$file.new" "$file"
done <"$here/dkms-jenkins-matrix.conf"

# Generate the common summary.
"$here/dkms-jenkins-matrix" --versions 3 <"$here/dkms-jenkins-matrix.conf" >"$out/dkms-matrix.html.new"
mv -f "$out/dkms-matrix.html.new" "$out/dkms-matrix.html"

