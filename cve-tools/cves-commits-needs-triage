#!/bin/bash

here=`dirname $0`
case "$here" in
/*) ;;
*)  here="`pwd`/$here" ;;
esac

prefix=`dirname "$1"`

cat "$@" |
	awk '
		BEGIN				{ cve="BEGIN"; needs_triage=0; linux=0 }
		/^Candidate:/			{ if (linux != 0 && needs_triage != 0) { print cve }; cve="'"$prefix"'/" $2; needs_triage=0; linux=0; }
		/^Patches_linux/		{ linux=1; next }
		/^Patches_/			{ linux=0; next }
		(linux == 1 && $2 == "needs-triage") 	{ needs_triage=1; }
		END				{ if (linux != 0 && needs_triage != 0) { print cve } }
	'
