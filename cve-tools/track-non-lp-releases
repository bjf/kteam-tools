#!/bin/bash

if [ "$#" -ne 1 ]; then
	echo "Usage: $0 <lp_cache>" 1>&2
	exit 1
fi
lp_cache="$1"

vcheck()
{
	local vlist="$1"
	local url="$2"
	local src="$3"

	ver=`wget -q -O - "$url" | \
	    awk '
		/^Package:/				{ pkg=$2 }
		(/^Version:/ && pkg == "'"$src"'")	{ print $2 }
	    '
	`

	if [ "$ver" != "" ]; then
		[ ! -f "$vlist" ] && touch "$vlist"
		count=`grep -c "^$ver\$" "$vlist"`
		if [ "$count" -eq 0 ]; then
			echo "$ver" >>"$vlist"
		fi
	fi
}

vcheck "$lp_cache/precise-linux-lts-saucy_tags" http://oem.archive.canonical.com/dists/precise-oem-sp2/public/source/Sources linux-lts-saucy
vcheck "$lp_cache/precise-linux-lts-quantal_tags" http://oem.archive.canonical.com/dists/precise-oem-sp1/public/source/Sources linux-lts-quantal
