#!/bin/bash

date=`date --date "today" +%Y-%m-%d`

case "$1" in
generate)
    (cd "$HOME/cve-autotriage/cve-tracker" &&
        "$HOME/kteam-tools/cve-tools/kpi/kpi-cve-extract" "$date") >cve-info.json.new
    mv cve-info.json.new cve-info.json
    if [ ! -e historical/data/LATEST.json ]; then
	ln -s ../../cve-info.json historical/data/LATEST.json
    fi
    ;;
timestamp)
    "$HOME/kteam-tools/cve-tools/kpi/kpi-cve-graph-extract" cve-info.json >cve-info.txt.new
    mv cve-info.txt.new cve-info.txt
    ;;
generate-graphs)
    (cd historical/data && mkdir -p NEW && "$HOME/kteam-tools/cve-tools/kpi/kpi-cve-graph-all" NEW)
    mv historical/data/NEW/* historical
    ;;
history-sample)
    cp cve-info.json "historical/data/$date.json"
    ;;
esac
