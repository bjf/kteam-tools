#!/bin/bash

case "$1" in
daily)
	date_target=`date --date "today" +%Y-%m-%d`
	date_range='7 days'
	date_step='1 day'
	;;
weekly)
	date_target=`date --date "12pm last sunday + 24 hours" +%Y-%m-%d`
	date_range='3 months'
	date_step='1 week'
	;;
monthly)
	date_target=`date --date "today" +%Y-%m`-01
	date_range='4 years'
	date_step='1 month'
	;;
esac

date_stop=`date --date "$date_target - $date_range" +%Y-%m-%d`
bzr log --short | \
while IFS='	' read id_committer date
do
	#echo "id_committer<$id_committer> date<$date> date_target<$date_target>"
	[ "$date" = '' ] && continue

	if [ "$date_target" \< "$date_stop" ]; then
		break
	fi

	if [ "$date_target" \< "$date" ]; then
		continue
	fi
	while ! [ "$date_target" \< "$date" ]; do
		id="${id_committer## }"
		id="${id%% *}"
		##echo "FOUND $id $date $date_target"
		echo "$id" "$date_target"

		date_target=`date --date "$date_target - $date_step" +%Y-%m-%d`
	done
done
