#!/bin/bash

here=`dirname $0`
case "$here" in
/*) ;;
*)  here="`pwd`/$here" ;;
esac

#if [ "$#" -ne 1 ]; then
#	echo "Usage: $0 <output directory>" 1>&2
#	exit 1
#fi
#out="$1"

plot="/tmp/plot.$$"

while read series source
do
	echo "$series $source ..." 1>&2

	#"$here/kpi-cve-graph" "open" "$series" "$source" *.json >"$plot"
	# Last entry in precise is just junk :<
	#case "$series--$source" in
	#precise--linux)
	#	<"$plot" grep -v '^2017-05-29 ' >"$plot.new"
	#	mv "$plot.new" "$plot"
	#	;;
	#esac

	"$here/kpi-cve-graph" "influx-closed0" "$series" "$source" *.json >"$plot"
	# Last entry in precise is just junk :<
	case "$series--$source" in
	precise--linux)
		<"$plot" grep -v '^2017-05-29 ' >"$plot.new"
		mv "$plot.new" "$plot"
		;;
	esac
	#echo "v PLOT"
	cat "$plot"
	#echo "^ PLOT"

	#"$here/kpi-cve-graph" "needswork" "$series" "$source" *.json >"$plot"

	"$here/kpi-cve-graph" "influx-open-delta" "$series" "$source" *.json >"$plot"
	cat "$plot"

	#"$here/kpi-cve-graph" "closed-delta" "$series" "$source" *.json >"$plot"
done <<EOL
precise linux
precise/esm linux
trusty linux
xenial linux
zesty linux
artful linux
bionic linux
EOL
: <<EOL
lucid linux
precise linux
precise/esm linux
trusty linux
vivid/ubuntu-core linux
xenial linux
zesty linux
EOL

rm -f "$plot"
