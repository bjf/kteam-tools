#!/bin/bash

here=`dirname $0`
case "$here" in
/*) ;;
*)  here="`pwd`/$here" ;;
esac

outd="$HOME/public_html/status/dashboard-helper"
mkdir -p "$outd"
out="$outd/proposed-migration"

rm -f "$out"
wget -qO "$out" http://people.canonical.com/~ubuntu-archive/proposed-migration/update_output.txt

# extract and convert the last build time ...
read x x time <"$out"
time=`echo "$time" | sed -e 's@\.@/@' -e 's@\.@/@'`
time=`date --date="$time" +%s`

# And ... now is ...
now=`date  +%s`

# Record that we ran, and when proposed-migration last reported.
{
    echo "Update%sWatcher $now 1200 1800"
    echo "Proposed%sMigration $time 2100 3600"
} | "$here/dashboard-status-bulk" "proposed-watcher"
