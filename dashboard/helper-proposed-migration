#!/bin/bash

here=`dirname $0`
case "$here" in
/*) ;;
*)  here="`pwd`/$here" ;;
esac

out="$HOME/public_html/status/dashboard-helper/proposed-migration"
mkdir -p "$out"

while read name url
do
	file="$out/$name"
	rm -f "$file.new"
	wget -qO "$file.new" "$url"
	if [ -f "$file.new" ]; then
		mv -f "$file.new" "$file.migration"
	fi
done <<EOL
devel http://people.canonical.com/~ubuntu-archive/proposed-migration/update_excuses.yaml
trusty http://people.canonical.com/~ubuntu-archive/proposed-migration/trusty/update_excuses.yaml
utopic http://people.canonical.com/~ubuntu-archive/proposed-migration/utopic/update_excuses.yaml
EOL

# Record that we ran, and when proposed-migration last reported.
"$here/helper-proposed-migration-payload" "$out/"*.migration | \
    "$here/dashboard-status-bulk" "proposed-watcher"
